from libelf import *

MIPS32_OPCODE_MASK = 0b111111
MIPS32_OPCODE_OFFSET = 26

MIPS32_SREG_MASK = 0b11111
MIPS32_SREG_OFFSET = 21

MIPS32_TREG_MASK = 0b11111
MIPS32_TREG_OFFSET = 16

MIPS32_DREG_MASK = 0b11111
MIPS32_DREG_OFFSET = 11

MIPS32_FUNC_MASK = 0b111111
MIPS32_ITYPE_IMM_MASK = 0xffff
MIPS32_REG_GP = 28
MIPS32_REGS_NOT_GP = set(range(1, 32)) - set((MIPS32_REG_GP,))

MIPS32_OPCODE_REG = 0b000000
MIPS32_OPCODE_BGEZ_BLTZ = 0b000001
MIPS32_OPCODE_J = 0b000010
MIPS32_OPCODE_JAL = 0b000011

MIPS32_OPCODE_BEQ = 0b000100
MIPS32_OPCODE_BNE = 0b000101
MIPS32_OPCODE_BLEZ = 0b000110
MIPS32_OPCODE_BGTZ = 0b000111

MIPS32_OPCODE_ADDIU = 0b001001
MIPS32_OPCODE_LUI = 0b001111
MIPS32_OPCODE_LB = 0b100000
MIPS32_OPCODE_LH = 0b100001
MIPS32_OPCODE_LW = 0b100011
MIPS32_OPCODE_LBU = 0b100100
MIPS32_OPCODE_LHU = 0b100101
MIPS32_OPCODE_SB = 0b101000
MIPS32_OPCODE_SH = 0b101001
MIPS32_OPCODE_SW = 0b101011

MIPS32_OPCODES_LOADSTORE = (MIPS32_OPCODE_LB, MIPS32_OPCODE_LH, MIPS32_OPCODE_LW, MIPS32_OPCODE_LBU, MIPS32_OPCODE_LHU, MIPS32_OPCODE_SB, MIPS32_OPCODE_SH, MIPS32_OPCODE_SW)
MIPS32_OPCODES_ITYPES = MIPS32_OPCODES_LOADSTORE + (MIPS32_OPCODE_ADDIU,)
MIPS32_OPCODES_RELATIVE_JUMPS = (MIPS32_OPCODE_BGEZ_BLTZ, MIPS32_OPCODE_BEQ, MIPS32_OPCODE_BNE, MIPS32_OPCODE_BLEZ, MIPS32_OPCODE_BGTZ)

MIPS32_FUNC_ADD = 0b100000
MIPS32_FUNC_ADDU = 0b100001

def _get_sreg_from_itype(self, instruction):
    return (instruction & self.MIPS32_SREG_MASK) >> 21

def _get_treg_from_itype(self, instruction):
    return (instruction & self.MIPS32_TREG_MASK) >> 16

def _get_imm_from_jtype(self, instruction):
    return (instruction & ~self.MIPS32_OPCODE_MASK) << 2

def _get_sreg_from_rtype(self, instruction):
    return (instruction & self.MIPS32_SREG_MASK) >> 21

def _get_treg_from_rtype(self, instruction):
    return (instruction & self.MIPS32_TREG_MASK) >> 16

def _get_dreg_from_rtype(self, instruction):
    return (instruction & self.MIPS32_DREG_MASK) >> 11
